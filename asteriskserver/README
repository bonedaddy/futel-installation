## Deploy prod or stage to digital ocean manually
(normally, deploy stage and promote to prod)

all droplets:
hostname futel-prod|stage
size smallest
region San Francisco 1
ssh key (personal key)

create extension at callcentric
if creating new prod,
create DID forwarding rule sending incoming number to extension at callcentric
preferences/did forwarding

in conf:
create sip_callcentric.conf sip_local.conf
create extensions_local.conf extensions_secret.conf
create id_rsa id_rsa.pub

create droplet from image CentOS 6.5 x32
src/make_baseinstall.sh <ip>
save snapshot baseinstall_prod|stage

create droplet from snapshot baseinstall_prod|stage
# XXX add address of each sip client to src/iptables.sh
src/make_baseconfig.sh <ip>
save snapshot baseconfig_prod|stage
copy src/backup.sh to /etc/cron.d/backup-futel-prod on eurydice
XXX need one for stage too

create droplet from snapshot baseconfig_prod|stage
src/make_asteriskbox.sh <ip> <conf_version>
save snapshot asteriskbox_prod|stage

create A record for futel-stage

## promote stage to prod

XXX copy content from prod to stage
XXX shut down prod, or better just stop content from being added
rename futel-stage droplet to futel-prod
change A record for futel-prod to point to new futel-prod
delete A record for futel-stage
wait for DNS to propagate # XXX this takes tens of minutes
update DID forwarding rule sending incoming number to extension at callcentric
test new prod
snapshot and destroy old futel-prod

## set up client

XXX forward openvpn ports on whatever firewall is between youse? openvpn makes
    this unnecessary?
set up an openvpn router
http://www.dd-wrt.com/wiki/index.php/VPN_(the_easy_way)_v24%2B#Client_Configuration_-_DD-WRT
set up pap device

