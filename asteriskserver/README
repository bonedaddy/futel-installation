## Deploy a futel asterisk server on 32-bit centos.

We will start with test_32,
update centos to get centos6_32_baseinstall,
install/config to get an asterisk box.

## Deploy to virtualbox:

# Make boxes and init:
vagrant box add test_32 http://developer.nrel.gov/downloads/vagrant-boxes/CentOS-6.5-i386-v20140110.box
vagrant init

# make centos6_32_baseinstall from test_32

export vagrantbox=test_32
vagrant up
vagrant halt
vagrant package --base asteriskserver_default_...
mv package.box ../centos6_32_baseinstall.box
vagrant box add ../centos6_32_baseinstall centos6_32_baseinstall.box
vagrant destroy

# fix and replace centos6_32_baseinstall

export vagrantbox=centos6_32_baseinstall_fix
vagrant up
vagrant ssh # and run the commands in fix_package.sh
vagrant halt
vagrant package --base asteriskserver_default_...
mv package.box ../centos6_32_baseinstall.box
vagrant box remove centos6_32_baseinstall
vagrant box add centos6_32_baseinstall ../centos6_32_baseinstall.box
vagrant destroy

# make centos6_32_baseconfig from centos6_32_baseinstall
export vagrantbox=centos6_32_baseinstall
vagrant up
vagrant halt
vagrant package --base asteriskserver_default_...
mv package.box ../centos6_32_baseconfig.box
vagrant box add ../centos6_32_baseconfig ../centos6_32_baseconfig.box
vagrant destroy

# make asteriskbox from centos6_32_baseinstall
export vagrantbox=centos6_32_baseconfig
# edit Vagrantfile
config.vm.box = "centos6_32_baseinstall"
config.vm.provision :shell, :path => "bootstrap.sh"

# write secrets files
# conf/sip_callcentric.conf
# conf/extensions_secret.conf

vagrant up

## Deploy to digital ocean

Since we can't yet package boxes from digital ocean, we will save
snapshots, which is bogus.

vagrant plugin install vagrant-digitalocean
# XXX wtf is even in this box
#     we will want to start with a less vagranty box
vagrant box add test_32 http://developer.nrel.gov/downloads/vagrant-boxes/CentOS-6.5-i386-v20140110.box

# edit Vagrantfile in ~/.vagrant.d for digital ocean secrets
# this is bogus, maybe set env vars instead
config.vm.provider :digital_ocean do |provider| ...

# edit Vagrantfile
config.vm.box = "digital_ocean"

vagrant up --provider=digital_ocean
vagrant ssh -c "yum -y install rsync"

# edit Vagrantfile
config.vm.provision :shell, :path => "centos6_32_baseinstall.sh" 

vagrant provision
# reboot might be necessary since we still do virtualbox interface cleanup
vagrant halt; vagrant up; vagrant halt
# save snapshot centos6_32_baseinstall

# edit Vagrantfile
config.vm.provision :shell, :path => "centos6_32_baseconfig.sh" 
vagrant provision
# save snapshot centos6_32_baseconfig

# edit Vagrantfile
config.vm.provision :shell, :path => "bootstrap.sh"
vagrant provision
# save snapshot asteriskbox
