# Setup for Twilio SIP registration endpoint, Programmable Voice, TwiML Bin

## asterisk server creds

have SIP extension 700
have SIP password PASSWORD

## twilio creds

have credential list username 700
have credential list password PASSWORD

## set up TwiML bin dial700atstage

body:
  <?xml version="1.0" encoding="UTF-8"?>
  <Response>
  <Dial>
      <Sip username="700" password="PASSWORD">sip:999@futel-stage.phu73l.net</Sip>
  </Dial>
  </Response>

## set up TwiML bin dial700atprod

body:
  <?xml version="1.0" encoding="UTF-8"?>
  <Response>
  <Dial>
      <Sip username="700" password="PASSWORD">sip:999@futel-prod.phu73l.net</Sip>
  </Dial>
  </Response>

## add TwiML bin dial700stageattwilio

body:
<?xml version="1.0" encoding="UTF-8"?>
    <Response>
        <Dial answerOnBridge="true">
            <Sip>700@700.stage.futel.sip.us1.twilio.com</Sip>
        </Dial>
</Response>

## add TwiML bin dial700prodattwilio

body:
<?xml version="1.0" encoding="UTF-8"?>
    <Response>
        <Dial answerOnBridge="true">
            <Sip>700@700.prod.futel.sip.us1.twilio.com</Sip>
        </Dial>
</Response>

## set up SIP domain 700.stage.futel.sip.twilio.com

Friendly name: 700.stage
SIP URI: 700.stage.futel (.sip.twilio.com)
Call control configuration: TwiML Bin: dial700atstage
Voice authentication: credential lists: 700
SIP registration: enabled
SIP Registration Authentication: credential lists: 700

## set up SIP domain 700.prod.futel.sip.twilio.com:

Friendly name: 700.prod
SIP URI: 700.prod.futel (.sip.twilio.com)
Call control configuration: TwiML Bin: dial700atprod
Voice authentication: credential lists: 700
SIP registration: enabled
SIP Registration Authentication: credential lists: 700

## set up SIP domain termination.stage.futel.sip.twilio.com

Friendly name: termination.stage
SIP URI: termination.stage.futel (.sip.twilio.com)
Call control configuration: TwiML Bin: dial700stageattwilio
Voice authentication: credential lists: 700
SIP registration: disabled

## set up SIP domain termination.prod.futel.sip.twilio.com

Friendly name: termination.prod
SIP URI: termination.prod.futel (.sip.twilio.com)
Call control configuration: TwiML Bin: dial700prodattwilio
Voice authentication: credential lists: 700
SIP registration: disabled

## set up client

register to 700@700.stage.futel.sip.us1.twilio.com
register to 700@700.prod.futel.sip.us1.twilio.com
password is as for credential list for 700

## test

register
dial any number, get outgoing-by-calling-extension context for 700
call SIP/700@twilio-pv-termination, registered client gets call
