# Setup for Twilio SIP registration endpoint, Programmable Voice, TwiML Bin

## asterisk server creds

have SIP extensions XXX
have SIP passwords YYY

## twilio creds

have credential list username XXX (same as SIP extension)
have credential list password

## set up TwiML bin dialXXXatstage

(for asterisk SIP extension XXX)

body:
  <?xml version="1.0" encoding="UTF-8"?>
  <Response>
  <Dial>
      <Sip username="XXX" password="YYY">sip:999@futel-stage.phu73l.net</Sip>
  </Dial>
  </Response>

## set up TwiML bin dialXXXatprod

(for asterisk SIP extension XXX)

body:
  <?xml version="1.0" encoding="UTF-8"?>
  <Response>
  <Dial>
      <Sip username="XXX" password="YYY">sip:999@futel-prod.phu73l.net</Sip>
  </Dial>
  </Response>


## set up SIP domain XXX.stage.futel.sip.twilio.com

(for asterisk SIP extension XXX)

SIP URI: XXX.stage.futel
Call control configuration: TwiML Bin: dial700atstage
Voice authentication: credential lists: XXX
SIP registration: enabled
SIP Registration Authentication: credential lists: XXX

set up SIP domain XXX.prod.futel.sip.twilio.com:
(for asterisk SIP extension XXX)

SIP URI: XXX.prod.futel
Call control configuration: TwiML Bin: dial700atprod
Voice authentication: credential lists: XXX
SIP registration: enabled
SIP Registration Authentication: credential lists: XXX

## set up client

XXX this should be XXX.stage.futel.us1.sip.twilio.com?
register to XXX@XXX.stage.futel.sip.us1.twilio.com
register to XXX@XXX.prod.futel.sip.us1.twilio.com
password is for credential list for XXX

## test

register
dial any number, get server context configured for incoming call from ext XXX

# TODO

incoming?
XXX dial from linphone? no
dial SIP url XXX@XXX.stage.futel.sip.us1.twilio.com, call client
dial SIP url XXX@XXX.prod.futel.sip.us1.twilio.com, call client
dial from asterisk? 
same => n,Dial(SIP/700@700.stage.futel.sip.us1.twilio.com)
same => n,Dial(SIP/700:<pass>@700.stage.futel.sip.us1.twilio.com)
no,
[May 19 22:10:56] VERBOSE[30123][C-00000000] app_dial.c: Called SIP/700@700.stage.futel.sip.us1.twilio.com
[May 19 22:10:56] NOTICE[30062][C-00000000] chan_sip.c: Failed to authenticate on INVITE to '"700" <sip:+15034681337@198.199.98.162>;tag=as3cefb3c0'
[May 19 22:10:56] VERBOSE[30123][C-00000000] app_dial.c: SIP/700.stage.futel.sip.us1.twilio.com-00000001 is circuit-busy

just have one SIP domain per group, for example year of creation
use registered extension to send to analog of outgoing-by-calling-extension
or can we find the calling extension and send to context on server for 999?
try BYOC trunk

# XXX

## set up TwiML bin dialXXXattwilio

have SIP domain with uri XXX.stage.futel.sip.twilio.com

body:
<?xml version="1.0" encoding="UTF-8"?>
<Response>
<Dial>
    <Sip>XXX@XXX.stage.futel.sip.twilio.com</Sip>
</Dial>
</Response>


# Setup for Twilio BYOC

